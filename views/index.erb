<html>
<head>
  <title id="t"></title>
  <meta name="viewport" id="v" content="width=device-width, user-scalable=1">
  <style>
    *{margin:0;padding:0}
  </style> 
</head>
<body>
<script src="/faye.js"></script>
<script>
  var v = document.getElementById("v");

  var iframe = {
    build: function() {
      var iframe = document.createElement('iframe');
      iframe.setAttribute('style', 'width:320px;border:0');
      document.body.appendChild(iframe);
      this.i = iframe;
    },

    update: function(address) {
      this.i.setAttribute('src', address);
    }
  };

  var frameset = {
    build: function() {
      var frame = document.createElement('frame');
      var fs = document.createElement('frameset');
      fs.setAttribute('frameborder', '0');
      fs.appendChild(frame);
      document.body.appendChild(fs);
      this.fs = fs;
      frame.onload = function() { v.content = "" };
    },

    update: function(address) {
      this.f.setAttribute('src', address);
    }
  };

  function detectMethod() {
    return frameset;
  }

  var method = detectMethod();
  method.build();
  method.update("<%= URI.encode(CurrentURL["address"]) %>");

  Faye.WebSocketTransport.isUsable = function() { return false }
  client = new Faye.Client('/faye', { timeout: 30 });
  client.subscribe('/url', function(msg) {
    method.update(msg.address);
  });
</script>
</body>
</html>
